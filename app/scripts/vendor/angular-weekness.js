angular.module("iso.config",[]).value("iso.config",{});angular.module("iso.filters",["iso.config"]);angular.module("iso.services",["iso.config"]);angular.module("iso.directives",["iso.config","iso.services"]);angular.module("iso",["iso.filters","iso.services","iso.directives","iso.config"]);var angularIsotopeCtrl=function($scope,$timeout,optionsStore){"use strict";var onLayoutEvent="isotope.onLayout",postInitialized=false,isotopeContainer=null,buffer=[],scope="",isoMode="";$scope.$on(onLayoutEvent,function(event){});$scope.layoutEventEmit=function($elems,instance){$timeout(function(){$scope.$apply(function(){$scope.$emit(onLayoutEvent)})})};optionsStore.store({onLayout:$scope.layoutEventEmit});var initEventHandler=function(fun,evt,hnd){if(evt)fun.call($scope,evt,hnd)};$scope.init=function(isoInit){isotopeContainer=isoInit.element;initEventHandler($scope.$on,isoInit.isoOptionsEvent,optionsHandler);initEventHandler($scope.$on,isoInit.isoMethodEvent,methodHandler);$scope.isoMode=isoInit.isoMode||"addItems";$timeout(function(){isotopeContainer.isotope(optionsStore.retrieve());postInitialized=true})};$scope.setIsoElement=function($element){if(postInitialized){$timeout(function(){isotopeContainer.isotope($scope.isoMode,$element)})}};$scope.refreshIso=function(){if(postInitialized){isotopeContainer.isotope()}};$scope.updateOptions=function(option){if(isotopeContainer){isotopeContainer.isotope(option)}else{optionsStore.store(option)}};var optionsHandler=function(event,option){$scope.updateOptions(option)};var methodHandler=function(event,option){var fun=option.fun;var params=option.params;fun.apply($scope,params)};initEventHandler($scope.$on,"iso-opts",optionsHandler);initEventHandler($scope.$on,"iso-method",methodHandler);$scope.removeAll=function(cb){isotopeContainer.isotope("remove",isotopeContainer.data("isotope").$allAtoms,cb)};$scope.refresh=function(){isotopeContainer.isotope()}};"use strict";angular.module("WeeknessApp").controller("ContribCtrl",function($scope,contribs,_){$scope.percentage=0;$scope.contrib={title:"",body:"",weekness:"",artifactType:"",artifact:""};$scope.artifactTypes=["image","other"];$scope.flags={artifactUploaded:false};$scope.actions={submit:function(){contribs.create($scope.contrib)}};$scope.$on("fileuploaddone",function(e,response){$scope.flags.artifactUploaded=true;var file=response.result.files[0],keys=_.keys(file),i,blacklist=[];for(i=0;i<keys.length;i++){if(keys[i].charAt(0)=="$")blacklist.push(keys[i])}file=_.omit(file,blacklist);$scope.contrib.artifact=file});$scope.$watch("contrib.artifactType",function(){$scope.files=[];$scope.flags.artifactUploaded=false})});"use strict";angular.module("WeeknessApp").controller("DebugCtrl",function($scope,_,users){users.get({},function(results){$scope.debug_log=results;console.log($scope.debug_lug)})});"use strict";angular.module("WeeknessApp").controller("FakerCtrl",function($scope,$rootScope,_){$scope.fakeCount=0;var random=function(possible){return possible[Math.floor(Math.random()*possible.length)]};var generator={};generator.title=function(){var possible=["Title","Vitle","Spitle"];return random(possible)};generator.body=function(){var possible=["rabble","tabble","babble"];return random(possible)};generator.weekness=function(){var possible=["health","tech","home","boats","boots","booties"];return random(possible)};generator.artifact=function(){var possible=['{"name":"016_3yEmUFm.gif","size":63908,"type":"image/gif","delete_type":"DELETE","delete_url":"http://localhost:8888/files/016_3yEmUFm.gif","url":"http://localhost:8888/files/016_3yEmUFm.gif","thumbnail_url":"http://localhost:8888/files/thumbnail/016_3yEmUFm.gif"}','{"name":"002_NW0mK39.gif","size":117037,"type":"image/gif","delete_type":"DELETE","delete_url":"http://localhost:8888/files/002_NW0mK39.gif","url":"http://localhost:8888/files/002_NW0mK39.gif","thumbnail_url":"http://localhost:8888/files/thumbnail/002_NW0mK39.gif"}','{"name":"009_XQiErrk (8).gif","size":94203,"type":"image/gif","delete_type":"DELETE","delete_url":"http://localhost:8888/files/009_XQiErrk%20(8).gif","url":"http://localhost:8888/files/009_XQiErrk%20(8).gif","thumbnail_url":"http://localhost:8888/files/thumbnail/009_XQiErrk%20(8).gif"}'];return random(possible)};$scope.contrib.artifactType="image";$scope.$watch("flags.artifactUploaded",function(){$scope.flags.artifactUploaded=true});$scope.fake=function(){$scope.processing=true;$scope.contrib.title=generator["title"]();$scope.contrib.body=generator.body();$scope.contrib.weekness=generator.weekness();$scope.contrib.artifact=generator.artifact();$scope.actions.submit()};$scope.$on("contribdone",function(){if(--$scope.fakeCount>0){$scope.fake()}else{$scope.contrib=_.pick($scope.contrib,["artifactType"]);$scope.processing=false}})});"use strict";angular.module("WeeknessApp").controller("FileDestroyCtrl",function($scope,$http){var file=$scope.file,state;if(file.url){file.$state=function(){return state};file.$destroy=function(){state="pending";return $http({url:file.delete_url,method:file.delete_type}).then(function(){state="resolved";$scope.clear(file)},function(){state="rejected"})}}else if(!file.$cancel&&!file._index){file.$cancel=function(){$scope.clear(file)}}});!function(){"use strict";angular.module("WeeknessApp").controller("FileUploadCtrl",function($scope,$http,$filter,$window,uploadUrl){$scope.loadingFiles=true;$scope.options={url:uploadUrl,maxNumberOfFiles:1};return $http.get(uploadUrl).then(function(response){$scope.loadingFiles=false;return $scope.queue=[]},function(){return $scope.loadingFiles=false})})}.call(this);var isoSortByDataCtrl=function($scope,optionsStore){$scope.getHash=function(s){return"opt"+s};$scope.storeMethods=function(methods){optionsStore.store({getSortData:methods})};$scope.optSortData=function(item,index){var elementSortData={},$item=$(item),selector=$item.attr("ok-sel"),type=$item.attr("ok-type"),sortKey=$scope.getHash(selector),fun=$item.attr("opt-convert")?eval("["+$item.attr("opt-convert")+"]")[0]:null,genSortDataClosure=function(selector,type,convert){return function($elem){return getValue(selector,$elem,type,convert)}};elementSortData[sortKey]=genSortDataClosure(selector,type,fun);return elementSortData};$scope.createSortByDataMethods=function(elem){var options=$(elem),sortDataArray=reduce($.map(options,$scope.optSortData));return sortDataArray};var reduce=function(list){var reduction={};$.each(list,function(index,item){$.extend(reduction,item)});return reduction},getValue=function(selector,$elem,type,evaluate){var getText=function($elem,item,selector){if(!item.length){return $elem.text()}var text="";switch(selector.charAt(0)){case"#":text=item.text();break;case".":text=item.text();break;case"[":text=item.attr(selector.replace("[","").replace("]","").split()[0]);break}return text},toType=function(text,type){var numCheck=function(val){return isNaN(val)?Number.POSITIVE_INFINITY:val},utility={text:function(s){return s.toString()},integer:function(s){return numCheck(parseInt(s,10))},"float":function(s){return numCheck(parseFloat(s))},"boolean":function(s){return"true"===s}};return utility[type]?utility[type](text):text},item=$elem.find(selector),text=getText($elem,item,selector),val=toType(text,type);return evaluate?evaluate(val):val}};"use strict";angular.module("WeeknessApp").controller("LoginCtrl",function($scope,users,$state){$scope.user={username:"",password:"",role:"anonymous"};$scope.authenticate=function(e){users.authenticate(e.target.form[0].value,e.target.form[1].value)};$scope.$on("authentication",function(e,response){$scope.authError=response;if(response=="available")$state.transitionTo("register")});$scope.$on("event:auth-loginConfirmed",function(){$scope.user=users.user.get();console.log(users.user.get())})});"use strict";angular.module("WeeknessApp").controller("MainCtrl",function($scope,db){$scope.contribs=[];var addToList=function(contrib){var s=angular.element("#isotopeContainer").scope();s.count=s.count||0;s.$apply(s.contribs.push(contrib))};db.Contrib.query({limit:50},{},function(e){$.each(e,function(){console.log(this);this.artifact=$.parseJSON(this.artifact)});$scope.contribs=e})});"use strict";angular.module("WeeknessApp").controller("RegisterCtrl",function($scope,users,$location,$state){$scope.authError="no-error";$scope.user=users.user.get();$scope.user.role="user";$scope.availability=function(e){users.authenticate(e.target.form[0].value)};$scope.submit=function(){users.create($scope.user)};$scope.getNumber=function(num){return new Array(num)};$scope.$on("authentication",function(e,response){$scope.authError=response;console.log(response)});$scope.$on("event:auth-loginConfirmed",function(){$scope.user=users.user.get();$state.transitionTo("main")})});"use strict";angular.module("iso.directives").directive("isotopeContainer",["$injector",function($injector){"use strict";var options={};return{controller:angularIsotopeCtrl,link:function(scope,element,attrs){var linkOptions=[],isoOptions=attrs.isoOptions,isoInit={};if(isoOptions){linkOptions=scope.$eval("["+isoOptions+"]");if(angular.isObject(linkOptions[0])){scope.updateOptions(linkOptions[0])}}isoInit["element"]=element;isoInit["isoOptionsEvent"]=attrs.isoOptionsSubscribe;isoInit["isoMethodEvent"]=attrs.isoMethodSubscribe;isoInit["isoMode"]=attrs.isoMode;scope.init(isoInit);return element}}}]);angular.module("iso.directives").directive("isotopeItem",["$timeout",function($timeout){return{restrict:"A",link:function(scope,element,attrs){var $element=$(element);scope.setIsoElement($element);if(attrs.ngRepeat&&true===scope.$last&&"addItems"==scope.isoMode){element.ready(function(){$timeout(function(){scope.refreshIso()})})}return element}}}]);"use strict";angular.module("WeeknessApp").directive("contribArtifact",function(){return{restrict:"A",require:"ngModel",link:function(scope,elem,attr,ctrl){ctrl.$parsers.unshift(function(value){ctrl.$setValidity("contribArtifact",scope.flags.artifactUploaded);return valid?value:undefined});ctrl.$formatters.unshift(function(value){ctrl.$setValidity("contribArtifact",scope.flags.artifactUploaded);return value})}}});"use strict";angular.module("WeeknessApp").directive("contribMain",function(){return{compile:function compile(iElement,iAttrs){return function postLink(scope,iElement,iAttrs){if(scope.contrib)iElement.text(scope.contrib.title)}},template:"<div></div>",restrict:"A",link:function postLink(scope,iElement,iAttrs){console.log("link: function postLink in directives/contribMain.js")}}});"use strict";angular.module("iso.directives").directive("isoSortbyData",function(optionsStore){return{restrict:"A",controller:isoSortByDataCtrl,replace:true,link:function(scope,element,attrs){var optionSet=$(element),optKey=optionSet.attr("ok-key"),optEvent="iso-opts",options={},methSet=optionSet.children().find("[ok-sel]");methSet.each(function(index){var $this=$(this);$this.attr("ok-sortby-key",scope.getHash($this.attr("ok-sel")))});var methods=scope.createSortByDataMethods(methSet);scope.storeMethods(methods)}}});"use strict";angular.module("iso.directives").directive("optKind",function(){return{restrict:"A",replace:true,link:function(scope,element,attrs){var optionSet=$(element),optPublish=attrs.optPublish||"opt-kind",optKey=optionSet.attr("ok-key"),selected=optionSet.find(".selected"),preSelectOptions={};var createOptions=function(item){if(item){var option={},virtualSortByKey=item.attr("ok-sortby-key"),ascAttr=item.attr("opt-ascending"),key=virtualSortByKey||item.attr("ok-sel");if(virtualSortByKey){option["sortAscending"]=ascAttr?ascAttr==="true":true}option[optKey]=key;return option}},emitOption=function(option){scope.preSelectOptions=$.extend.apply(null,[true,scope.preSelectOptions].concat(option));option["ok"]=scope.preSelectOptions;scope.$emit(optPublish,option)},doOption=function(event){event.preventDefault();var selItem=$(event.target);if(selItem.hasClass("selected")){return false}optionSet.find(".selected").removeClass("selected");selItem.addClass("selected");emitOption(createOptions(selItem));return false};if(selected.length){scope.preSelectOptions=createOptions(selected)}optionSet.on("click",function(event){doOption(event)})}}});"use strict";angular.module("WeeknessApp").service("contribs",function contribs(db,$rootScope){var $error="";var $contribFields=["title","body","weekness","artifactType","artifact"];return{error:$error,get:function(conditions,callback){db.Contrib.query(conditions,{},function(matches){callback(matches)})},create:function(contrib){contrib=_.pick(contrib,$contribFields);var time=(new Date).getTime();contrib.created=time;contrib.updated=time;db.Contrib.save(contrib,{},function(e){console.log(e);console.log("Created contrib: "+contrib.title);$rootScope.$broadcast("contribdone")})}}});"use strict";var res;angular.module("WeeknessApp").factory("db",function($resource,$http){var db={};var actions={count:{method:"PUT",params:{_id:"count"}},distinct:{method:"PUT",params:{_id:"distinct"}},find:{method:"PUT",params:{_id:"find"},isArray:true},group:{method:"PUT",params:{_id:"group"},isArray:true},mapReduce:{method:"PUT",params:{_id:"mapReduce"},isArray:true},aggregate:{method:"PUT",params:{_id:"aggregate"},isArray:true}};db.User=$resource("/api/users/:id",{},actions);db.Contrib=$resource("/api/contribs/:id",{},actions);return db});angular.module("iso.services",[],function($provide){$provide.factory("optionsStore",function(){"use strict";var storedOptions={};return{store:function(option){storedOptions=$.extend.apply(null,[true,storedOptions].concat(option))},retrieve:function(){return storedOptions}}})});"use strict";angular.module("WeeknessApp").service("users",function users(db,authService,_,$rootScope){var $error="";var $user={username:undefined,password:undefined,email:undefined,age:undefined,city:undefined,state:undefined,country:undefined,sex:undefined,bio:undefined,role:undefined};return{error:$error,get:function(conditions,callback){db.User.query(conditions,{},function(matches){console.log(matches);callback(matches)})},user:{get:function(keyOrKeys){if(!keyOrKeys){return $user}else{return _.pick($user,keyOrKeys)}},set:function(user){$user=_.clone(user)}},authenticate:function(username,password){$user.username=username;db.User.query({username:username},{},function(matches){console.log(matches);if(matches.length>0&&password){db.User.query({username:username,password:password},{},function(matches){if(matches.length>0){$error="correct";$user=_.clone(matches[0]);authService.loginConfirmed()}else{$error="invalid"}$rootScope.$broadcast("authentication",$error)})}else if(matches.length===0){$error="available"}else{$error="taken"}$rootScope.$broadcast("authentication",$error)})},create:function(user){db.User.save(user,{},function(e){authService.loginConfirmed();console.log("Created account for "+user.username);console.log(e)})}}});